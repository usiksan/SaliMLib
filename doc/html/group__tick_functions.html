<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SaliMLib: SaliMLib Tick functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SaliMLib
   &#160;<span id="projectnumber">0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">SaliMLib Tick functions<div class="ingroups"><a class="el" href="group___c_plus_plus_part.html">SaliMLib core library</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This functions used for work with system tick count.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga9408bec94b4c57d3ccfdda3c776d235e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tick_functions.html#ga9408bec94b4c57d3ccfdda3c776d235e">smTickFuture</a> (int tickOut)</td></tr>
<tr class="memdesc:ga9408bec94b4c57d3ccfdda3c776d235e"><td class="mdescLeft">&#160;</td><td class="mdescRight">smTickFuture Helper function for calculate moment in the future. Is used for time out calculation.  <a href="#ga9408bec94b4c57d3ccfdda3c776d235e">More...</a><br /></td></tr>
<tr class="separator:ga9408bec94b4c57d3ccfdda3c776d235e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3bfae15fff1499c06d14f916c632c975"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tick_functions.html#ga3bfae15fff1499c06d14f916c632c975">smTickIsOut</a> (int futureTick)</td></tr>
<tr class="memdesc:ga3bfae15fff1499c06d14f916c632c975"><td class="mdescLeft">&#160;</td><td class="mdescRight">smTickIsOut Helper function to detect when time out. This function indifferent to wrap smTickCount and will work correctly  <a href="#ga3bfae15fff1499c06d14f916c632c975">More...</a><br /></td></tr>
<tr class="separator:ga3bfae15fff1499c06d14f916c632c975"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This functions used for work with system tick count. </p>
<p>Usually, to implement work with time, use the decrement of variables: A global variable is defined: </p><div class="fragment"><div class="line"><span class="comment">//Некоторая глобальная переменная</span></div><div class="line"><span class="keywordtype">int</span> someTimeOut;</div></div><!-- fragment --><p>The following is added to the system timer interrupt handler: </p><div class="fragment"><div class="line"><span class="comment">//Timer decrement in the system timer handler interrupt</span></div><div class="line"><span class="keywordflow">if</span>( someTimeOut ) someTimeOut--;</div></div><!-- fragment --><p>Then the program initializes the timer: </p><div class="fragment"><div class="line"><span class="comment">//Setup timer</span></div><div class="line">someTimeOut = 1000;</div></div><!-- fragment --><p>Then it is periodically checked and some actions are performed after it expires (or until it has expired): </p><div class="fragment"><div class="line"><span class="keywordflow">if</span>( someTimeOut == 0 ) {</div><div class="line">  <span class="comment">//Time&#39;s up, we&#39;re doing something</span></div><div class="line">  }</div></div><!-- fragment --><p>If there are several timers, all the specified steps are repeated. The program size and resources consumed grow linearly with the number of timers. This approach is simple, but inefficient. Instead, SaliMLib uses a different principle: there is a single global tick counter </p><div class="fragment"><div class="line"><span class="keyword">volatile</span> <span class="keywordtype">int</span> <a class="code" href="group__cpart.html#ga4a9031c426fd5947ec4e562017059e44">smTickCount</a>;</div></div><!-- fragment --><p>The system timer interrupt handler is added to: </p><div class="fragment"><div class="line">smTickCount++; <span class="comment">// Increment of the system tick counter</span></div></div><!-- fragment --><p>Next, if you need to create a timer, it can be created locally: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> f()</div><div class="line"> {</div><div class="line"> <span class="comment">//Create timer</span></div><div class="line"> <span class="keywordtype">int</span> localTimer = <a class="code" href="group__tick_functions.html#ga9408bec94b4c57d3ccfdda3c776d235e">smTickFuture</a>( 1000 );</div><div class="line"> <span class="comment">//That is equivalently localTimer = smTickCount + 1000;</span></div><div class="line"> <span class="keywordflow">if</span>( <a class="code" href="group__tick_functions.html#ga3bfae15fff1499c06d14f916c632c975">smTickIsOut</a>(localTimer) ) {</div><div class="line">   <span class="comment">//Time&#39;s up, we&#39;re doing something</span></div><div class="line">   }</div><div class="line"> }</div></div><!-- fragment --> <h2 class="groupheader">Function Documentation</h2>
<a id="ga9408bec94b4c57d3ccfdda3c776d235e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9408bec94b4c57d3ccfdda3c776d235e">&#9670;&nbsp;</a></span>smTickFuture()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int smTickFuture </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tickOut</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>smTickFuture Helper function for calculate moment in the future. Is used for time out calculation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tickOut</td><td>Time which added to current time to get future moment </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Time moment in the future</dd></dl>
<p>Each timer in SaliMLib is a simple integer variable that represents a point in time in the future. By comparing this value of this variable with the clock counter, you can determine when this moment will occur. Therefore, only the system tick counter is incremented, not every timer. This approach radically reduces the computational burden of maintaining each timer and simplifies the code.</p>
<p>The smTickFuture function is used to get this point in the future relative to the current value of the system clock counter. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> someTimer = <a class="code" href="group__tick_functions.html#ga9408bec94b4c57d3ccfdda3c776d235e">smTickFuture</a>( 1000 );</div></div><!-- fragment --><p> Creates a moment in the future that is 1000 clock cycles away from the current one. Accordingly, the timer will trigger 1000 clock cycles after this moment. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__tick_functions.html#ga3bfae15fff1499c06d14f916c632c975" title="smTickIsOut Helper function to detect when time out. This function indifferent to wrap smTickCount an...">smTickIsOut</a>, <a class="el" href="group__cpart.html#ga4a9031c426fd5947ec4e562017059e44" title="smTickCount System tick counter ">smTickCount</a> </dd></dl>

</div>
</div>
<a id="ga3bfae15fff1499c06d14f916c632c975"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3bfae15fff1499c06d14f916c632c975">&#9670;&nbsp;</a></span>smTickIsOut()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool smTickIsOut </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>futureTick</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>smTickIsOut Helper function to detect when time out. This function indifferent to wrap smTickCount and will work correctly </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">futureTick</td><td>Moment in the future. When smTickCount rich this moment function will return true </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true - when smTickCount rich futureTime moment</dd></dl>
<p>The smTickIsOut function compares the timer value with the tick counter. as soon as they are equal, this function returns true. The duration of the system operation is not limited by the capacity of the tick counter variable. Counting time intervals works fine even after this counter is" wrapped " (overflowed). However, there is a limitation. It consists in the maximum duration of the counted intervals. It is about 2 billion ticks. If the tick counter increases every millisecond (the normal value), the maximum time interval is about 23 days. This limitation is insignificant for the vast majority of embedded systems and can be solved for counting long intervals by using, for example, the built-in calendar.</p>
<p>This timer system may be used also without SaliMLib.</p>
<p>With SaliMLib system timers adds the functionality of the timing and functions of expectations. For example, using the wait function to set the led to blink: </p><div class="fragment"><div class="line"> <span class="keywordflow">while</span>(<span class="keyword">true</span>) {</div><div class="line">   <span class="comment">//Led is on</span></div><div class="line">   LedOn();</div><div class="line">   <span class="comment">//Wait for appropriate time</span></div><div class="line">   <a class="code" href="group__wait_functions.html#ga542182b81ea8e1653720b0864c9c7705">smWaitTick</a>(300); <span class="comment">//Here is switch to execution of other task</span></div><div class="line"></div><div class="line">   <span class="comment">//Led is off</span></div><div class="line">   LedOff();</div><div class="line">   <span class="comment">//Wait for appropriate time</span></div><div class="line">   <a class="code" href="group__wait_functions.html#ga542182b81ea8e1653720b0864c9c7705">smWaitTick</a>(300); <span class="comment">//Here is switch to execution of other task</span></div><div class="line">}</div></div><!-- fragment --><p>Timers can also be used to limit the waiting time for events: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> f()</div><div class="line">  {</div><div class="line">  <span class="comment">//Create timer</span></div><div class="line">  <span class="keywordtype">int</span> localTimer = <a class="code" href="group__tick_functions.html#ga9408bec94b4c57d3ccfdda3c776d235e">smTickFuture</a>( 1000 );</div><div class="line"></div><div class="line">  <span class="comment">//Wait for operation is completed or timeOut</span></div><div class="line">  smWait&lt;int&gt;( &amp;localTimer, [] ( <span class="keywordtype">int</span> *localTimerPtr ) -&gt; <span class="keywordtype">bool</span> {</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__tick_functions.html#ga3bfae15fff1499c06d14f916c632c975">smTickIsOut</a>(*localTimerPtr) || isOperationComplete();</div><div class="line">    });</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span>( <a class="code" href="group__tick_functions.html#ga3bfae15fff1499c06d14f916c632c975">smTickIsOut</a>(localTimer) ) {</div><div class="line">    <span class="comment">//Timeout</span></div><div class="line">    }</div><div class="line">  <span class="keywordflow">else</span> {</div><div class="line">    <span class="comment">//Operation is successfull</span></div><div class="line">    }</div><div class="line">  }</div></div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__tick_functions.html#ga9408bec94b4c57d3ccfdda3c776d235e" title="smTickFuture Helper function for calculate moment in the future. Is used for time out calculation...">smTickFuture</a>, <a class="el" href="group__cpart.html#ga4a9031c426fd5947ec4e562017059e44" title="smTickCount System tick counter ">smTickCount</a> </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
